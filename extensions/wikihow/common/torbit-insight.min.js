/* Copyright and full source available at: http://insight.torbit.com/v1/rum.js */ var TBRUM=TBRUM||EPISODES||{};TBRUM.q=TBRUM.q||[];TBRUM.q.push(["mark","script-firstbyte",(new Date).getTime()]);TBRUM.version="0.2";TBRUM.perf_obj=false;TBRUM.beaconUrl=TBRUM.beaconUrl||"//insight.torbit.com/beacon.gif";TBRUM.autorun="undefined"!=typeof TBRUM.autorun?TBRUM.autorun:true;TBRUM.init=function(){TBRUM.bDone=false;TBRUM.marks={};TBRUM.measures={};TBRUM.starts={};TBRUM.addEventListener("beforeunload",TBRUM.beforeUnload,false);TBRUM.addEventListener("load",TBRUM.onload,false);(function(){var a=false;var b=function(){};var c=function(a){b=d(a);e()};var d=function(b){return function(){if(!a){a=true;b()}}};var e=function(){if(document.addEventListener){document.addEventListener("DOMContentLoaded",b,false)}else if(document.attachEvent){document.attachEvent("onreadystatechange",b);var a=false;try{a=window.frameElement==null}catch(c){}if(document.documentElement.doScroll&&a){f()}}};var f=function(){if(a){return}try{document.documentElement.doScroll("left")}catch(c){setTimeout(f,5);return}b()};c(function(){TBRUM.mark("onready");TBRUM.measure("onready","starttime","onready")})})();TBRUM.processQ();TBRUM.findStartTime()};TBRUM.processQ=function(){var a=TBRUM.q.length;for(var b=0;b<a;b++){var c=TBRUM.q[b];var d=c[0];if("mark"===d){TBRUM.mark(c[1],c[2])}else if("measure"===d){TBRUM.measure(c[1],c[2],c[3])}else if("done"===d){TBRUM.done(c[1])}else if("tags"===d){if(TBRUM.tags)TBRUM.tags+=",";else TBRUM.tags="";TBRUM.tags+=c[1]}else if("conv"===d){TBRUM.conversions=c.slice(1).join("|")}}};TBRUM.q.push=function(){var a=Array.prototype.slice.call(arguments[0],0);var b=a[0];var c=a.slice(1);if("conv"==b){TBRUM.conversions=c.join("|");if(TBRUM.bDone)TBRUM.beaconWrapper()}else if("tags"===b){if(TBRUM.tags)TBRUM.tags+=",";else TBRUM.tags="";TBRUM.tags+=arguments[0][1]}};TBRUM.mark=function(a,b){if(!a){return}TBRUM.marks[a]=parseInt(b||(new Date).getTime());if("firstbyte"===a){TBRUM.measure("backend","starttime","firstbyte")}else if("onload"===a){TBRUM.measure("frontend","firstbyte","onload");TBRUM.measure("onload","starttime","onload")}else if("done"===a){TBRUM.measure("total_load_time","starttime","done")}};TBRUM.measure=function(a,b,c){if(!a){return}var d;if("undefined"===typeof b){if("number"===typeof TBRUM.marks[a]){d=TBRUM.marks[a]}else{d=(new Date).getTime()}}else if("number"===typeof TBRUM.marks[b]){d=TBRUM.marks[b]}else if("number"===typeof b){d=b}else{return}var e;if("undefined"===typeof c){e=(new Date).getTime()}else if("number"===typeof TBRUM.marks[c]){e=TBRUM.marks[c]}else if("number"===typeof c){e=c}else{return}TBRUM.starts[a]=parseInt(d);TBRUM.measures[a]=parseInt(e-d)};TBRUM.done=function(a){TBRUM.mark("done");var b=TBRUM.measure;if(TBRUM.perf_obj){var c=TBRUM.mark;var d=window.performance.timing;for(var e in d){c(e,d[e])}b("red_t","redirectStart","redirectEnd");b("cache_t","fetchStart","domainLookupStart");b("dns_t","domainLookupStart","domainLookupEnd");b("tcp_t","connectStart","connectEnd");b("b_wait_t","requestStart","responseStart");b("b_tran_t","responseStart","responseEnd");b("onready_t","navigationStart","domContentLoadedEventStart");b("onload_t","navigationStart","loadEventStart");b("scr_proc_t","script-firstbyte","script-done")}if(TBRUM.autorun&&!TBRUM.bDone){TBRUM.beaconWrapper();if(TBRUM.measures["onload_t"]&&TBRUM.measures["onload_t"]>0)onload_time=TBRUM.measures["onload_t"];else if(TBRUM.measures["onload"]&&TBRUM.measures["onload"]>0)onload_time=TBRUM.measures["onload"];cookie_str=TBRUM.getCookie("TBTIM");if(cookie_str){parts=cookie_str.split("|");if(parts.length<2){cookie_str=onload_time+"|1"}else{cookie_str=parseInt(parts[0])+onload_time+"|"+(parseInt(parts[1])+1)}}else{cookie_str=onload_time+"|1"}TBRUM.setCookie("TBTIM",cookie_str,true)}TBRUM.bDone=true;if("function"===typeof a){a()}};TBRUM.beaconWrapper=function(){TBRUM.sendBeacon(false,{src:TBRUM.src,tbtim:TBRUM.getCookie("TBTIM"),conversion:TBRUM.conversions||"",tags:TBRUM.tags||""})};TBRUM.sendBeacon=function(a,b){a=a||TBRUM.beaconUrl;var c=TBRUM.measures;var d="?";for(var e in c){d+=escape(e)+"="+c[e]+"&"}if(d.length>1){d=d.substr(0,d.length-1);if(b){for(var e in b){if(b.hasOwnProperty(e)){d+="&"+escape(e)+"="+escape(b[e])}}}TBRUM.img_beacon=new Image;TBRUM.img_beacon.src=a+d+"&v="+TBRUM.version;return TBRUM.img_beacon.src}return""};TBRUM.findStartTime=function(){var a=TBRUM.findStartWebTiming()||TBRUM.findStartGToolbar()||TBRUM.findStartCookie();if(!a&&TBRUM.marks["firstbyte"]){a=TBRUM.marks["firstbyte"];TBRUM.src="inline"}if(a){TBRUM.mark("starttime",a)}};TBRUM.findStartWebTiming=function(){var a=undefined;if(navigator.userAgent.match(/Firefox/i))return false;var b=window.performance||window.mozPerformance||window.msPerformance||window.webkitPerformance;if("undefined"!=typeof b&&"undefined"!=typeof b.timing&&"undefined"!=typeof b.timing["navigationStart"]){TBRUM.perf_obj=true;a=b.timing["navigationStart"];TBRUM.src="nav"}return a};TBRUM.findStartGToolbar=function(){var a=undefined;if("undefined"!=typeof window.external&&"undefined"!=typeof window.external.pageT){a=(new Date).getTime()-window.external.pageT}else if("undefined"!=typeof window.gtbExternal&&"undefined"!=typeof window.gtbExternal.pageT){a=(new Date).getTime()-window.gtbExternal.pageT()}else if("undefined"!=typeof window.chrome&&"undefined"!=typeof window.chrome.csi){a=(new Date).getTime()-window.chrome.csi().pageT}if(a)TBRUM.src="gt";return a};TBRUM.findStartCookie=function(){var a=document.cookie.split(" ");for(var b=0;b<a.length;b++){if(0===a[b].indexOf("TBRUM=")){var c=a[b].substring("TBRUM=".length).split("&");var d,e;for(var f=0;f<c.length;f++){if(0===c[f].indexOf("s=")){d=c[f].substring(2)}else if(0===c[f].indexOf("r=")){var g=c[f].substring(2);e=escape(document.referrer)==g}}if(e&&d){TBRUM.src="cook";return d}}}return undefined};TBRUM.getCookie=function(a){var b=document.cookie;var c=b.indexOf(a);var d=b.indexOf(";",c)==-1?b.length:b.indexOf(";",c);if(c==-1)return"";return unescape(b.substring(c+(a.length+1),d))};TBRUM.setCookie=function(a,b,c){if(!a||!b){return 0}if(c){var d=new Date((new Date).getTime()+(new Date).getTimezoneOffset()*6e4+24*60*60*1e3);var e=";expires="+(new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate())).toUTCString().replace(/ [0-9]+\:/," 00:")}else{var e=""}document.cookie=a+"="+b+e+";path=/;"};TBRUM.beforeUnload=function(a){TBRUM.setCookie("TBRUM","s="+Number(new Date)+"&r="+escape(document.location))};TBRUM.onload=function(a){TBRUM.mark("onload",(new Date).getTime());if(TBRUM.autorun){TBRUM.done()}};TBRUM.addEventListener=function(a,b,c){if("undefined"!=typeof window.attachEvent){return window.attachEvent("on"+a,b)}else if(window.addEventListener){return window.addEventListener(a,b,c)}};TBRUM.init();TBRUM.mark("script-done",(new Date).getTime())